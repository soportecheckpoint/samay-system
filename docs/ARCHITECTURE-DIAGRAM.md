# Diagrama de Arquitectura del Sistema

## ğŸ—ï¸ Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVIDOR CENTRAL                             â”‚
â”‚                      Node.js + Socket.io                             â”‚
â”‚                    http://192.168.1.10:3001                          â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Routes     â”‚  â”‚   Socket     â”‚  â”‚   Services   â”‚              â”‚
â”‚  â”‚   /connect   â”‚  â”‚   Handlers   â”‚  â”‚   Timer      â”‚              â”‚
â”‚  â”‚   /dispatch  â”‚  â”‚              â”‚  â”‚   Arduino    â”‚              â”‚
â”‚  â”‚   /heartbeat â”‚  â”‚              â”‚  â”‚              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚              Estado Global (gameState)              â”‚            â”‚
â”‚  â”‚  - arduinos: { buttons, connections, nfc }          â”‚            â”‚
â”‚  â”‚  - session: { timer, teamName, status }             â”‚            â”‚
â”‚  â”‚  - games: { MODULE_BUTTONS, MODULE_TABLET, ... }    â”‚            â”‚
â”‚  â”‚  - clients: { socket connections }                  â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ WebSocket (Socket.io)
                             â”‚ HTTP REST
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   HTTP POST  â”‚     â”‚   HTTP POST  â”‚    â”‚   HTTP POST  â”‚
â”‚   (Arduino)  â”‚     â”‚   (Arduino)  â”‚    â”‚   (Arduino)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ARDUINO    â”‚     â”‚   ARDUINO    â”‚    â”‚   ARDUINO    â”‚
â”‚   Botones    â”‚     â”‚  Conexiones  â”‚    â”‚   NFC/RFID   â”‚
â”‚   (buttons)  â”‚     â”‚(connections) â”‚    â”‚    (nfc)     â”‚
â”‚              â”‚     â”‚              â”‚    â”‚              â”‚
â”‚  8 Botones   â”‚     â”‚  12-16 Pines â”‚    â”‚  5 Lectores  â”‚
â”‚  FÃ­sicos     â”‚     â”‚  + Cables    â”‚    â”‚  RC522       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²                    â–²                    â–²
        â”‚                    â”‚                    â”‚
        â”‚ Servidor HTTP      â”‚ Servidor HTTP      â”‚ Servidor HTTP
        â”‚ :8080/control      â”‚ :8080/control      â”‚ :8080/control
        â”‚                    â”‚                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                      Comandos desde
                        Servidor
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                         â”‚
        â–¼                                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebSocket       â”‚                    â”‚  WebSocket       â”‚
â”‚  Clientes        â”‚                    â”‚  Clientes        â”‚
â”‚  (Apps React)    â”‚                    â”‚  (Apps React)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                         â”‚
        â”‚                                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                â”‚          â”‚          â”‚                  â”‚
â–¼                â–¼          â–¼          â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚ â”‚ Buttons â”‚ â”‚  Main   â”‚ â”‚  Tablet  â”‚ â”‚  Totem   â”‚
â”‚   iPad   â”‚ â”‚  Game   â”‚ â”‚ Screen  â”‚ â”‚ Feedback â”‚ â”‚ TÃ¡ctil   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de ComunicaciÃ³n Completo

### 1. InicializaciÃ³n del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Arduino  â”‚                  â”‚ Servidor â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚  POST /connect              â”‚
     â”‚  { id, ip, port }           â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚                             â”‚
     â”‚  200 OK                     â”‚
     â”‚  { status: registered }     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚                             â”‚
     â”‚  (Cada 15 segundos)         â”‚
     â”‚  POST /heartbeat            â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚                             â”‚
     â”‚  200 OK                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚                             â”‚
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App Reactâ”‚                  â”‚ Servidor â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                             â”‚
     â”‚  WebSocket connect          â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚                             â”‚
     â”‚  emit('register')           â”‚
     â”‚  { appType, sessionId }     â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚                             â”‚
     â”‚  emit('state:update')       â”‚
     â”‚  { session, tablet }        â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚                             â”‚
```

---

### 2. Juego de Botones - Flujo Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Buttons  â”‚  â”‚ Servidor â”‚  â”‚ Arduino  â”‚  â”‚   Main   â”‚  â”‚  Admin   â”‚
â”‚   App    â”‚  â”‚          â”‚  â”‚          â”‚  â”‚  Screen  â”‚  â”‚   iPad   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚ User ingresaâ”‚             â”‚             â”‚             â”‚
     â”‚ cÃ³digo 1606 â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚emit(buttons:â”‚             â”‚             â”‚             â”‚
     â”‚code-entered)â”‚             â”‚             â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚ POST        â”‚             â”‚             â”‚
     â”‚             â”‚/control     â”‚             â”‚             â”‚
     â”‚             â”‚{cmd:start}  â”‚             â”‚             â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚ 200 OK      â”‚             â”‚             â”‚
     â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚on(buttons:  â”‚             â”‚ Arduino     â”‚             â”‚
     â”‚game-started)â”‚             â”‚ inicia      â”‚             â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚ juego       â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ User        â”‚             â”‚
     â”‚             â”‚             â”‚ presiona    â”‚             â”‚
     â”‚             â”‚             â”‚ botÃ³n 1     â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚ POST        â”‚             â”‚             â”‚
     â”‚             â”‚ /dispatch   â”‚             â”‚             â”‚
     â”‚             â”‚ {event:     â”‚             â”‚             â”‚
     â”‚             â”‚  buttons:   â”‚             â”‚             â”‚
     â”‚             â”‚  state-     â”‚             â”‚             â”‚
     â”‚             â”‚  changed}   â”‚             â”‚             â”‚
     â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚ WebSocket   â”‚             â”‚             â”‚
     â”‚             â”‚ broadcast   â”‚             â”‚             â”‚
     â”‚             â”‚ a todos     â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚on(buttons:  â”‚             â”‚             â”‚on(buttons:  â”‚on(buttons:
     â”‚state-changedâ”‚             â”‚             â”‚state-changedâ”‚state-changed
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚ UI actualizaâ”‚             â”‚             â”‚ UI actualizaâ”‚ UI actualiza
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ User        â”‚             â”‚
     â”‚             â”‚             â”‚ completa    â”‚             â”‚
     â”‚             â”‚             â”‚ secuencia   â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚ POST        â”‚             â”‚             â”‚
     â”‚             â”‚ /dispatch   â”‚             â”‚             â”‚
     â”‚             â”‚ {completed: â”‚             â”‚             â”‚
     â”‚             â”‚  true,      â”‚             â”‚             â”‚
     â”‚             â”‚  code:1234} â”‚             â”‚             â”‚
     â”‚             â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚on(module:   â”‚             â”‚             â”‚on(module:   â”‚on(module:
     â”‚completed)   â”‚             â”‚             â”‚completed)   â”‚completed)
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>
     â”‚             â”‚             â”‚             â”‚             â”‚
     â”‚ Mostrar     â”‚             â”‚             â”‚ Mostrar     â”‚ Update
     â”‚ cÃ³digo 1234 â”‚             â”‚             â”‚ cÃ³digo 1234 â”‚ status
     â”‚             â”‚             â”‚             â”‚             â”‚
```

---

### 3. Tablero de Conexiones â†’ Totem TÃ¡ctil

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Arduino  â”‚  â”‚ Servidor â”‚  â”‚  Totem   â”‚  â”‚  Admin   â”‚
â”‚Conexionesâ”‚  â”‚          â”‚  â”‚ TÃ¡ctil   â”‚  â”‚   iPad   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚             â”‚             â”‚
     â”‚ User        â”‚             â”‚             â”‚
     â”‚ conecta     â”‚             â”‚             â”‚
     â”‚ cables      â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚ POST        â”‚             â”‚             â”‚
     â”‚ /dispatch   â”‚             â”‚             â”‚
     â”‚ {event:     â”‚             â”‚             â”‚
     â”‚  connectionsâ”‚             â”‚             â”‚
     â”‚  :state-    â”‚             â”‚             â”‚
     â”‚  changed}   â”‚             â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚ WebSocket   â”‚             â”‚
     â”‚             â”‚ broadcast   â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚on(connections            â”‚
     â”‚             â”‚:state-changed             â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ Totem       â”‚
     â”‚             â”‚             â”‚ actualiza   â”‚
     â”‚             â”‚             â”‚ estado      â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚ Todas las   â”‚             â”‚             â”‚
     â”‚ conexiones  â”‚             â”‚             â”‚
     â”‚ correctas   â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚ POST        â”‚             â”‚             â”‚
     â”‚ /dispatch   â”‚             â”‚             â”‚
     â”‚ {completed: â”‚             â”‚             â”‚
     â”‚  true,      â”‚             â”‚             â”‚
     â”‚  code:7482} â”‚             â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚on(connections            â”‚
     â”‚             â”‚:state-changed             â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ Totem activaâ”‚
     â”‚             â”‚             â”‚ fase de     â”‚
     â”‚             â”‚             â”‚ Match       â”‚
     â”‚             â”‚             â”‚ (muestra    â”‚
     â”‚             â”‚             â”‚ cÃ³digo 7482)â”‚
     â”‚             â”‚             â”‚             â”‚
```

---

### 4. NFC â†’ Totem TÃ¡ctil (6ta Insignia)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Arduino  â”‚  â”‚ Servidor â”‚  â”‚  Totem   â”‚
â”‚   NFC    â”‚  â”‚          â”‚  â”‚ TÃ¡ctil   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚             â”‚
     â”‚ User coloca â”‚             â”‚
     â”‚ insignias   â”‚             â”‚
     â”‚ NFC         â”‚             â”‚
     â”‚             â”‚             â”‚
     â”‚ POST        â”‚             â”‚
     â”‚ /dispatch   â”‚             â”‚
     â”‚ {event:     â”‚             â”‚
     â”‚  nfc:state- â”‚             â”‚
     â”‚  changed,   â”‚             â”‚
     â”‚  detected:3}â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚             â”‚             â”‚
     â”‚             â”‚on(nfc:      â”‚
     â”‚             â”‚state-changedâ”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ Totem       â”‚
     â”‚             â”‚             â”‚ actualiza   â”‚
     â”‚             â”‚             â”‚ contador    â”‚
     â”‚             â”‚             â”‚ insignias   â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚ Todas las 5 â”‚             â”‚             â”‚
     â”‚ insignias   â”‚             â”‚             â”‚
     â”‚ detectadas  â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚ POST        â”‚             â”‚             â”‚
     â”‚ /dispatch   â”‚             â”‚             â”‚
     â”‚ {completed: â”‚             â”‚             â”‚
     â”‚  true,      â”‚             â”‚             â”‚
     â”‚  badges:5}  â”‚             â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚on(nfc:      â”‚             â”‚
     â”‚             â”‚state-changedâ”‚             â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ Totem muestra
     â”‚             â”‚             â”‚ 6ta insigniaâ”‚
     â”‚             â”‚             â”‚ virtual     â”‚
     â”‚             â”‚             â”‚             â”‚
```

---

### 5. Tablet â†’ Main Screen (ProyecciÃ³n)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tablet  â”‚  â”‚ Servidor â”‚  â”‚   Main   â”‚
â”‚ Feedback â”‚  â”‚          â”‚  â”‚  Screen  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚             â”‚
     â”‚ User en     â”‚             â”‚
     â”‚ paso de     â”‚             â”‚
     â”‚ feedback    â”‚             â”‚
     â”‚             â”‚             â”‚
     â”‚emit(tablet: â”‚             â”‚
     â”‚mirror)      â”‚             â”‚
     â”‚{screen:     â”‚             â”‚
     â”‚ feedback_   â”‚             â”‚
     â”‚ form,       â”‚             â”‚
     â”‚ content:{}} â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚             â”‚             â”‚
     â”‚             â”‚on(tablet:   â”‚
     â”‚             â”‚mirror)      â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ Main Screenâ”‚
     â”‚             â”‚             â”‚ proyecta   â”‚
     â”‚             â”‚             â”‚ contenido  â”‚
     â”‚             â”‚             â”‚ en tiempo  â”‚
     â”‚             â”‚             â”‚ real       â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚ User escribeâ”‚             â”‚             â”‚
     â”‚ feedback    â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚emit(tablet: â”‚             â”‚             â”‚
     â”‚mirror)      â”‚             â”‚             â”‚
     â”‚{content:    â”‚             â”‚             â”‚
     â”‚ {feedback   â”‚             â”‚             â”‚
     â”‚ Text:"..."}}â”‚             â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚on(tablet:   â”‚             â”‚
     â”‚             â”‚mirror)      â”‚             â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ Actualiza   â”‚
     â”‚             â”‚             â”‚ texto en    â”‚
     â”‚             â”‚             â”‚ proyecciÃ³n  â”‚
     â”‚             â”‚             â”‚             â”‚
```

---

### 6. Admin iPad - Control Total

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚  â”‚ Servidor â”‚  â”‚ Arduino  â”‚  â”‚  Apps    â”‚
â”‚   iPad   â”‚  â”‚          â”‚  â”‚          â”‚  â”‚  React   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚             â”‚             â”‚             â”‚
     â”‚emit(admin:  â”‚             â”‚             â”‚
     â”‚get-state)   â”‚             â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚on(admin:    â”‚             â”‚             â”‚
     â”‚state-update)â”‚             â”‚             â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚ Mostrar     â”‚             â”‚             â”‚
     â”‚ estado de   â”‚             â”‚             â”‚
     â”‚ todos los   â”‚             â”‚             â”‚
     â”‚ mÃ³dulos     â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚emit(admin:  â”‚             â”‚             â”‚
     â”‚command)     â”‚             â”‚             â”‚
     â”‚{cmd:'reset- â”‚             â”‚             â”‚
     â”‚ module',    â”‚             â”‚             â”‚
     â”‚ data:{      â”‚             â”‚             â”‚
     â”‚ module:     â”‚             â”‚             â”‚
     â”‚ 'buttons'}} â”‚             â”‚             â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚ POST        â”‚             â”‚
     â”‚             â”‚/control     â”‚             â”‚
     â”‚             â”‚{cmd:reset}  â”‚             â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚ Arduino     â”‚
     â”‚             â”‚             â”‚ resetea     â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚on(buttons:  â”‚             â”‚
     â”‚             â”‚reset)       â”‚             â”‚
     â”‚             â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚             â”‚             â”‚             â”‚
     â”‚             â”‚             â”‚             â”‚ Apps
     â”‚             â”‚             â”‚             â”‚ resetean
     â”‚             â”‚             â”‚             â”‚ estado
     â”‚             â”‚             â”‚             â”‚
```

---

## ğŸ“Š Tabla de ComunicaciÃ³n

| Origen | Destino | Protocolo | Endpoint/Event | PropÃ³sito |
|--------|---------|-----------|----------------|-----------|
| Arduino | Servidor | HTTP POST | `/connect` | Registro inicial |
| Arduino | Servidor | HTTP POST | `/heartbeat` | SeÃ±al de vida |
| Arduino | Servidor | HTTP POST | `/dispatch` | Enviar eventos |
| Servidor | Arduino | HTTP POST | `:8080/control` | Enviar comandos |
| App React | Servidor | WebSocket | `register` | Registro de cliente |
| App React | Servidor | WebSocket | eventos varios | Acciones de usuario |
| Servidor | App React | WebSocket | eventos varios | Actualizaciones de estado |
| Servidor | Todas las Apps | WebSocket | broadcast | DistribuciÃ³n de eventos |

---

## ğŸ”‘ IDs y Nombres Clave

### Arduino IDs
- `"buttons"` - Arduino de botones
- `"connections"` o `"tablero-conexiones"` - Arduino de conexiones
- `"nfc"`, `"rfid"` o `"tablero-nfc"` - Arduino NFC/RFID

### Module IDs (Estado del Servidor)
- `"MODULE_BUTTONS"` - MÃ³dulo de botones
- `"MODULE_TABLET"` - MÃ³dulo de tablet
- `"MODULE_TOTEM"` - MÃ³dulo de totem
- `"MODULE_CONNECTIONS"` - MÃ³dulo de conexiones (opcional)
- `"MODULE_RFID"` o `"MODULE_NFC"` - MÃ³dulo NFC (opcional)

### App Types
- `"admin-ipad"` - iPad administrador
- `"buttons-game"` - Juego de botones
- `"main-screen"` - Pantalla principal
- `"tablet-feedback"` - Tablet de feedback
- `"totem-tactil"` - Totem tÃ¡ctil

---

## ğŸ“ Notas Importantes

1. **Todos los Arduinos** deben estar conectados a la misma red que el servidor
2. **El servidor** debe tener IP fija o un hostname conocido
3. **Los heartbeats** son crÃ­ticos - el servidor marca Arduinos como desconectados despuÃ©s de 30s sin heartbeat
4. **Los eventos** son broadcast a todas las apps conectadas - cada app filtra lo que necesita
5. **El Admin iPad** es la Ãºnica interfaz con control total del sistema
6. **La Main Screen** solo recibe eventos, no envÃ­a ninguno
7. **El Totem** puede configurarse para escuchar diferentes eventos mediante variables de entorno
